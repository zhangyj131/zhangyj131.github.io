<!DOCTYPE html>
<html lang="zh-CN">


<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>
    zhangyj Blog
  </title>
  <meta name="description" content="My Blog Description">
  
  <meta name="keywords" content="
  
  ">
  
  <meta name="author" content="zhangyj">

  <meta http-equiv="Cache-Control" content="no-transform"/>
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="theme-color" content="#1e2327">
  <link rel="apple-touch-icon" href="https://github.githubassets.com/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://github.githubassets.com/apple-touch-icon-180x180.png">

  <link rel="icon" type="image/x-icon" href="https://github.githubassets.com/favicon.ico">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  

  

  <script src="//cdnjs.cloudflare.com/ajax/libs/vue/1.0.25-csp/vue.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
<meta name="generator" content="Hexo 5.4.1"></head>

<body id="replica-app">

<nav class="navbar-wrapper">
  <div class="navbar">
    <div class="container clearfix">
      <a href="/" class="navbar-logo"><i class="fa fa-github"></i></a>

      <div class="navbar-search float-left desktop-only">
        <div class="navbar-search-form">
          <label for="gsc-i-id1">This website</label>
          <div id="google-search">
            <gcse:search></gcse:search>
          </div>
        </div>
      </div>

      <ul class="navbar-nav float-left">
        
        <li><a href="/archives">Archives</a></li>
        
        
        <li><a href="/categories">Categories</a></li>
        
        
        <li><a href="/tags">Tags</a></li>
        
        
        <li class="desktop-only"><a href="/atom.xml" target="_blank">RSS</a></li>
        
      </ul>

      <ul class="navbar-nav user-nav float-right desktop-only">
        <li class="user-nav-notification">
          <a><span class="user-nav-unread"></span><i class="fa fa-bell"></i></a>
        </li>
        <li>
          <a><i class="fa fa-plus"></i> <i class="fa fa-caret-down"></i></a>
        </li>
        <li class="user-nav-logo">
          <a><img src="https://cdn.jsdelivr.net/gh/zhangyj131/mdpicture/docs/20220327204436.bmp"> <i class="fa fa-caret-down"></i></i></a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="main-container">
  <header class="header-wrapper desktop-only">
  <div class="container header-site-detail">
    <ul class="header-toolbar">
      <li class="clearfix">
        <a href="/archives" class="header-toolbar-left"><i
                  class="fa fa-file-text"></i> Posts </a>
        <a href="/archives"
           class="header-toolbar-right"> 5 </a>
      </li>
      <li>
        <a href="/tags" class="header-toolbar-left"><i
                  class="fa fa-tags"></i> Tags </a>
        <a href="/tags"
           class="header-toolbar-right"> 2 </a>
      </li>
      <li>
        <a href="/categories" class="header-toolbar-left"><i
                  class="fa fa-folder-open"></i> Categories </a>
        <a href="/categories"
           class="header-toolbar-right"> 2 </a>
      </li>
    </ul>
    <h2 class="header-title">
      <i class="fa fa-book text-muted"></i>
      <a href="/">zhangyj Blog</a>
      
      
    </h2>
  </div>

  <div class="container">
    <div class="header-tab-wrapper clearfix">
      <span class="header-tab header-tab-selected"><i class="fa fa-thumbs-o-up"></i> Like</span>
      <span class="header-tab"><i class="fa fa-share-alt"></i> Share</span>
      <span class="header-tab"><i class="fa fa-comments-o"></i> Discussion</span>
      <span class="header-tab"><i class="fa fa-bookmark-o"></i> Bookmark </span>
      <span class="header-tab"><i class="fa fa-smile-o"></i> Smile <i class="fa fa-caret-down"></i></span>
    </div>
  </div>
</header>


<div class="post-container container">
  <h3>
    <i class="fa fa-user-o"></i>
    zhangyj

    <span class="post-date float-right" title="{{moment(1648487082903).format('MMM DD, YYYY, h:mm:ss A')}}">
      
          <i class="fa fa-pencil-square-o"></i>
      
      {{moment(1648487082903).fromNow()}}
    </span>
  </h3>

  <article class="post-content">
    <h1>Untitle</h1>
    <h2 id="1-受检异常vs非受检异常"><a href="#1-受检异常vs非受检异常" class="headerlink" title="1.受检异常vs非受检异常"></a>1.受检异常vs非受检异常</h2><h2 id="2-jdk8-stream"><a href="#2-jdk8-stream" class="headerlink" title="2.jdk8 stream"></a>2.jdk8 stream</h2><p><strong>collectingAndThen</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a9ad46f86fb4">https://www.jianshu.com/p/a9ad46f86fb4</a></p>
<p>java.util.stream.Stream.collect(Collector&lt;? super T, A, R&gt;)用于把数据转换为另一种形式，Collector可以用Collectors生成，Collectors的常用api如下</p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/entry/6844903462107365389">https://juejin.im/entry/6844903462107365389</a></p>
<p><strong>2.1.将流中的数据转成集合类型，方法形式是toXXX():</strong> </p>
<p>​    toCollection：把stream流结果转换为Collection，将数据转换为指定的集合</p>
<p>​    toList：把stream流结果转换为List，将流中所有项目收集到一个List</p>
<p>​    toSet：把stream流结果转换为Set，将流中所有项目收集到一个Set</p>
<p>​    toMap：把stream流结果转换为Map，就是HashMap</p>
<p>​    toConcurrentMap：把stream流结果转换为Map，就是ConcurrentMap</p>
<p>2.2.将流中的数据(字符串)使用分隔符拼接在一起：joining<br>2.3.对流中的数据求最大值maxBy、最小值minBy、求和summingInt、求平均值averagingDouble</p>
<p>​    maxBy()：筛选流中最大元素的Optional，流为空则Optional.empty()<br>​    minBy()：筛选流中最小元素的Optional，流为空则Optional.empty()    </p>
<p><strong>2.4.对流中的数据进行映射处理 mapping</strong></p>
<p>​    先对集合中的元素进行映射，然后再对映射的结果使用Collectors操作</p>
<p><strong>2.5.对流中的数据分组：groupingBy、partitioningBy、partitioningBy</strong></p>
<p>​    groupingBy：经过分组把stream流结果转换为Map，就是HashMap，可以分成true和false两组，也可以根据字段分成多组 </p>
<p>​    groupingByConcurrent：经过分组把stream流结果转换为Map，就是ConcurrentMap，可以分成true和false两组，也可以根据字段分成多组 </p>
<p>​    partitioningBy：只能分成true和false两组</p>
<p>2.5.对流中的数据累计计算：reducing</p>
<p><strong>2.6.collectingAndThen</strong></p>
<p>包裹一个收集器，对其结果应用转换函数    转换函数返回的类型 int i &#x3D; stream.collect(collectingAndThen(toList(),List :: size);</p>
<p><img src="https://cdn.jsdelivr.net/gh/zhangyj131/mdpicture/docs/20200902164627.png" alt="image-20200902164627293"></p>
<p><img src="https://cdn.jsdelivr.net/gh/zhangyj131/mdpicture/docs/20200902164652.png" alt="image-20200902164652251"></p>
<p>stream的例子</p>
<h3 id="2-1-list转list"><a href="#2-1-list转list" class="headerlink" title="2.1.list转list"></a>2.1.list转list</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//case1  list转list</span></span><br><span class="line"><span class="keyword">public</span> List&lt;OpenServiceVO&gt; <span class="title function_">queryList</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;OpenServicePO&gt; openServicePOS = openServiceMapper.selectAll();<span class="comment">//tkmybatis方法</span></span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(openServicePOS))&#123;</span><br><span class="line">            openServicePOS = openServicePOS.stream().filter(openServicePO -&gt; openServicePO.getIsShow()==<span class="number">1</span>) .</span><br><span class="line">            		sorted(Comparator.comparing(OpenServicePO::getUpdatedAt).reversed()).collect(Collectors.toList());</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;OpenServiceVO&gt; openServiceVOS = CopyListUtils.copyList(openServicePOS, OpenServiceVO.class);<span class="comment">//自己开发的listcopy工具类</span></span><br><span class="line">        <span class="keyword">return</span> openServiceVOS;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*	openServicePOS.stream()获取stream</span></span><br><span class="line"><span class="comment">*	filter(openServicePO -&gt; openServicePO.getIsShow()==1) 过滤isShow==1的元素，返回stream</span></span><br><span class="line"><span class="comment">*	Comparator.comparing(OpenServicePO::getUpdatedAt)按照updateAt更新日期排序，返回Comparator</span></span><br><span class="line"><span class="comment">*	reversed()翻转排序，返回Comparator	</span></span><br><span class="line"><span class="comment">*	sorted()传入Comparator</span></span><br><span class="line"><span class="comment">*	collect(Collectors.toList())把stream转换为list集合</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-list-lt-T-gt-转Map-lt-Integer-List-lt-R-gt"><a href="#2-2-list-lt-T-gt-转Map-lt-Integer-List-lt-R-gt" class="headerlink" title="2.2.list&lt;T&gt;转Map&lt;Integer, List&lt;R&gt;"></a>2.2.<code>list&lt;T&gt;转Map&lt;Integer, List&lt;R&gt;</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//case2  list转map</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;OpenTokenServiceWorkVo&gt; <span class="title function_">queryList</span><span class="params">(String applyUser, String auditUser, String tokenName, String url, Integer status, Integer userId, Integer roleId, Integer pageNum, Integer pageSize)</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        List&lt;Integer&gt; statuses = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(status))&#123;</span><br><span class="line">            statuses = Arrays.asList(OpenStatusEnum.TO_BE_AUDITED.getCode(),OpenStatusEnum.EFFECTIVE.getCode());</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (!Objects.equals(<span class="number">0</span>,status))&#123;</span><br><span class="line">            statuses = Arrays.asList(status);</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(<span class="string">&quot;statuses&quot;</span>,statuses);</span><br><span class="line">        map.put(<span class="string">&quot;tokenName&quot;</span>,tokenName);</span><br><span class="line">        map.put(<span class="string">&quot;auditUser&quot;</span>,auditUser);</span><br><span class="line">        map.put(<span class="string">&quot;applyUser&quot;</span>,applyUser);</span><br><span class="line">        List&lt;OpenTokenServiceWorkVo&gt; openTokenServiceWorkVos = openServiceTokenMapper.queryByCondition(map);</span><br><span class="line">        List&lt;OpenTokenServiceWorkVo&gt; openTokenServiceWorkVos1 = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isNotEmpty(openTokenServiceWorkVos))&#123;</span><br><span class="line">            <span class="comment">// 根据tokenId分组</span></span><br><span class="line">        	<span class="comment">/*</span></span><br><span class="line"><span class="comment">        	 * 把openTokenServiceWorkVos转换为Map&lt;Integer, List&lt;OpenServiceVO&gt;&gt;</span></span><br><span class="line"><span class="comment">        	 * Collectors.mapping() 先对集合中的元素进行映射，然后再对映射的结果使用Collectors操作，这里返回的就是list</span></span><br><span class="line"><span class="comment">        	 */</span></span><br><span class="line">            Map&lt;Integer, List&lt;OpenServiceVO&gt;&gt; collect = openTokenServiceWorkVos.stream().</span><br><span class="line">                    collect(Collectors.groupingBy(b -&gt; b.getId(),<span class="comment">//b就是OpenTokenServiceWorkVo</span></span><br><span class="line">                            Collectors.mapping(b -&gt; <span class="keyword">new</span> <span class="title class_">OpenServiceVO</span>(b.getUrl(),b.getDescription()), Collectors.toList())));<span class="comment">//先创建OpenServiceVO对象，mapping返回由Collectors.toList()决定，就是list</span></span><br><span class="line">            <span class="comment">// 根据tokenId去重</span></span><br><span class="line">            openTokenServiceWorkVos1 = openTokenServiceWorkVos.stream().collect(</span><br><span class="line">                    Collectors.collectingAndThen(Collectors.toCollection(</span><br><span class="line">                            () -&gt; <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;(Comparator.comparing(o -&gt; o.getId()))), ArrayList::<span class="keyword">new</span>)<span class="comment">//collectingAndThen是将流中的数据通过Collector计算，计算的结果再通过Function处理一下，返回的就是创建的ArrayList集合</span></span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (CollectionUtils.isNotEmpty(openTokenServiceWorkVos1))&#123;</span><br><span class="line">                openTokenServiceWorkVos1 = openTokenServiceWorkVos1.stream().sorted(Comparator.comparing(OpenTokenServiceWorkVo::getUpdatedAt).reversed()).collect(Collectors.toList());</span><br><span class="line">                openTokenServiceWorkVos1.stream().forEach(openTokenServiceWorkVo -&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!org.springframework.util.CollectionUtils.isEmpty(collect) &amp;&amp; collect.containsKey(openTokenServiceWorkVo.getId()))&#123;</span><br><span class="line">                        openTokenServiceWorkVo.setOpenServiceVOS(collect.get(openTokenServiceWorkVo.getId()));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">if</span> (CollectionUtils.isNotEmpty(openTokenServiceWorkVos1))&#123;</span><br><span class="line">                    openTokenServiceWorkVos1.stream().forEach(openTokenServiceWorkVo -&gt; &#123;</span><br><span class="line">                        openTokenServiceWorkVo.setAuditButton(RoleEnum.ADMIN.getRoleId().equals(roleId)</span><br><span class="line">                                &amp;&amp; Objects.equals(OpenStatusEnum.TO_BE_AUDITED.getCode(),openTokenServiceWorkVo.getStatus()));</span><br><span class="line">                        openTokenServiceWorkVo.setCancelButton(RoleEnum.ADMIN.getRoleId().equals(roleId)</span><br><span class="line">                                &amp;&amp; Objects.equals(OpenStatusEnum.EFFECTIVE.getCode(),openTokenServiceWorkVo.getStatus()));</span><br><span class="line">                        openTokenServiceWorkVo.setQueryDetailButton(Objects.equals(userId,openTokenServiceWorkVo.getContactId()));</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> openTokenServiceWorkVos1;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>stellar内com.zto.ares.backend.dbService.impl.OpenTokenServiceWorkServiceImpl.queryList(String, String, String, String, Integer, Integer, Integer, Integer, Integer)  stream使用最强大</p>
<h3 id="2-3-list-lt-T-gt-转List-lt-R-gt"><a href="#2-3-list-lt-T-gt-转List-lt-R-gt" class="headerlink" title="2.3.list&lt;T&gt;转List&lt;R&gt;"></a>2.3.<code>list&lt;T&gt;转List&lt;R&gt;</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//stream.map用法</span></span><br><span class="line"><span class="comment">//吧List&lt;FeatureVO&gt;转换为List&lt;BugVO&gt;</span></span><br><span class="line"><span class="keyword">private</span> OtherBranchRecordVO <span class="title function_">getBranchRecordVO</span><span class="params">(Integer id,List&lt;Integer&gt; productIdS,Integer roleId,Integer userId,Integer currentId,List&lt;String&gt; privileges)</span> &#123;</span><br><span class="line">    List&lt;FeatureVO&gt; featureVOS = getFeatureVOList(id, BRANCH_RECORD);</span><br><span class="line">        List&lt;FeatureVO&gt; featureList = featureVOS.stream().filter(featureVO -&gt; Objects.equals(JiraIssueTypeEnum.FEATURE.getJiraIssueType(), featureVO.getIssueType())).collect(Collectors.toList());</span><br><span class="line">        List&lt;BugVO&gt; bugMapperPOS = featureVOS.stream().filter(featureVO -&gt; Objects.equals(JiraIssueTypeEnum.BUG.getJiraIssueType(), featureVO.getIssueType()))</span><br><span class="line">                .map(featureVO -&gt; &#123;</span><br><span class="line">                    <span class="type">BugVO</span> <span class="variable">bug</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BugVO</span>();</span><br><span class="line">                    bug.setId(featureVO.getId());</span><br><span class="line">                    bug.setIssueSummary(featureVO.getIssueSummary());</span><br><span class="line">                    bug.setIssuePriority(featureVO.getIssuePriorityId());</span><br><span class="line">                    bug.setIssueStatus(featureVO.getIssueStatus());</span><br><span class="line">                    bug.setAssignee(featureVO.getAssignee());</span><br><span class="line">                    bug.setReporter(featureVO.getQatcName());</span><br><span class="line">                    bug.setIssuePriorityName(BugIssuePriorityEnum.getBugPriorityName(featureVO.getIssuePriorityId()));</span><br><span class="line">                    <span class="keyword">return</span> bug;</span><br><span class="line">                &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">//省略剩余代码</span></span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Long&gt; collect = featurePOS.stream()</span><br><span class="line">                        .filter(f -&gt; !getStatus().contains(f.getStatus()))</span><br><span class="line">                        .filter(f -&gt; !Objects.equals(FeatureStatusEnum.CANCEL.getFeatureStatus(), f.getStatus()))</span><br><span class="line">                        .map(FeaturePO::getId)</span><br><span class="line">                        .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">//map决定</span></span><br><span class="line">List&lt;Long&gt; collect = featurePOS.stream()</span><br><span class="line">                        .filter(f -&gt; !getStatus().contains(f.getStatus()))</span><br><span class="line">                        .filter(f -&gt; !Objects.equals(FeatureStatusEnum.CANCEL.getFeatureStatus(), f.getStatus()))</span><br><span class="line">                        .map(FeaturePO::getId)</span><br><span class="line">                        .collect(Collectors.toList());</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//参考 https://juejin.im/entry/6844903462107365389</span></span><br><span class="line">List&lt;DeployRecordManageDetail&gt; deployRecordManageDetails = deployRecordManageDetailMapper.selectDeployRecordByManageId(deployRecordId);</span><br><span class="line">            </span><br><span class="line">            Map&lt;String, DeployRecordManageDetail&gt; collect = deployRecordManageDetails.stream().collect(</span><br><span class="line">            		Collectors.groupingBy(DeployRecordManageDetail::getIp,</span><br><span class="line">            				Collectors.collectingAndThen(</span><br><span class="line">            						Collectors.maxBy(Comparator.comparingInt(DeployRecordManageDetail::getId)),</span><br><span class="line">                    				Optional::get</span><br><span class="line">                    		)</span><br><span class="line">            			)</span><br><span class="line">            		);</span><br><span class="line">            deployRecordManageDetails = collect.entrySet().stream().map(c -&gt; c.getValue()).collect(Collectors.toList());</span><br></pre></td></tr></table></figure>





<h2 id="3-lambda用法list转map"><a href="#3-lambda用法list转map" class="headerlink" title="3.lambda用法list转map"></a>3.lambda用法list转map</h2><p>常用方式<br>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;Long, String&gt; <span class="title function_">getIdNameMap</span><span class="params">(List&lt;Account&gt; accounts)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> accounts.stream().collect(Collectors.toMap(Account::getId, Account::getUsername));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>收集成实体本身map<br>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;Long, Account&gt; <span class="title function_">getIdAccountMap</span><span class="params">(List&lt;Account&gt; accounts)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> accounts.stream().collect(Collectors.toMap(Account::getId, account -&gt; account));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>account -&gt; account</strong>是一个返回本身的lambda表达式，其实还可以使用Function接口中的一个默认方法代替，使整个方法更简洁优雅：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;Long, Account&gt; <span class="title function_">getIdAccountMap</span><span class="params">(List&lt;Account&gt; accounts)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> accounts.stream().collect(Collectors.toMap(Account::getId, Function.identity()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重复key的情况</p>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;String, Account&gt; <span class="title function_">getNameAccountMap</span><span class="params">(List&lt;Account&gt; accounts)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> accounts.stream().collect(Collectors.toMap(Account::getUsername, Function.identity()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个方法可能报错（<strong>java.lang.IllegalStateException: Duplicate key</strong>），因为name是有可能重复的。<strong>toMap</strong>有个重载方法，可以传入一个合并的函数来解决key冲突问题：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;String, Account&gt; <span class="title function_">getNameAccountMap</span><span class="params">(List&lt;Account&gt; accounts)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> accounts.stream().collect(Collectors.toMap(Account::getUsername, Function.identity(), (key1, key2) -&gt; key2));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里只是简单的使用后者覆盖前者来解决key重复问题。</p>
<p>指定具体收集的map</p>
<p><strong>toMap</strong>还有另一个重载方法，可以指定一个Map的具体实现，来收集数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;String, Account&gt; <span class="title function_">getNameAccountMap</span><span class="params">(List&lt;Account&gt; accounts)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> accounts.stream().collect(Collectors.toMap(Account::getUsername, Function.identity(), (key1, key2) -&gt; key2, LinkedHashMap::<span class="keyword">new</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>以某个属性分组</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,List&lt;User&gt;&gt; map= userList.stream().collect(Collectors.groupingBy(User::getName));</span><br></pre></td></tr></table></figure>





<h2 id="4-lambda用法list转list"><a href="#4-lambda用法list转list" class="headerlink" title="4.lambda用法list转list"></a>4.lambda用法list转list</h2><p>获取集合中的某个属性转为集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pictureList.stream().map(Picture::getSrc).collect(Collectors.toList());</span><br></pre></td></tr></table></figure>

<p>根据集合中的某个属性进行升序重排</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roomList.stream().sorted(Comparator.comparing(Room::getAvgPrice)).collect(Collectors.toList());</span><br></pre></td></tr></table></figure>

<p>根据集合中的某个属性进行降序重排</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roomList.stream().sorted(Comparator.comparing(Room::getAvgPrice).reversed()).collect(Collectors.toList());</span><br></pre></td></tr></table></figure>

<p>集合中的属性去重</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpTags.stream().distinct().collect(Collectors.toList());</span><br></pre></td></tr></table></figure>

<p>根据集合中的某个属性过滤并获取第一个</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">benefitList.stream().filter(benefit -&gt; benefit.getId() == <span class="number">1</span> || benefit.getId() == <span class="number">20</span> || benefit.getId() == <span class="number">26</span> || benefit.getId() == <span class="number">89</span>) .findFirst().orElse(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<p>获取集合中某个最大值的int数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">partnerCityHotelDOList.stream().mapToInt(PartnerCityHotelDO::getId).max().orElse(-<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>提取集合中对象的某个属性转化List</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">partnerCityHotelDOList.stream().map(PartnerCityHotelDO::getId).collect(Collectors.toList());</span><br></pre></td></tr></table></figure>



<h2 id="5-lambda用法map转list"><a href="#5-lambda用法map转list" class="headerlink" title="5.lambda用法map转list"></a>5.lambda用法map转list</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map.keySet().stream().collect(Collectors.toList());</span><br></pre></td></tr></table></figure>



<h2 id="6-Optional用法实例"><a href="#6-Optional用法实例" class="headerlink" title="6.Optional用法实例"></a>6.Optional用法实例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getCharSet</span><span class="params">(Map&lt;String, String&gt; header)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(header).map(o -&gt; o.get(CHAR_SET_HEADER_KEY)).orElse(CHAR_SET);<span class="comment">//map的作用获取对象header中的具体对象，不使用map就是直接获取的是value，使用map可以获取value中的具体对象</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">getThrow404Exception</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(throw404Exception.get()).orElse(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> HttpConfigProperties <span class="title function_">getHttpConfigProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(httpConfigProperties).orElseGet(()-&gt;<span class="keyword">new</span> <span class="title class_">HttpConfigProperties</span>());<span class="comment">//httpConfigProperties非null返回httpConfigProperties对象，否则创建新的HttpConfigProperties对象</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ConsumerGroupMetadata</span> <span class="variable">metadata</span> <span class="operator">=</span> Optional.ofNullable(metadata).orElseThrow(() -&gt; ZmsException.MetainfoException);<span class="comment">//metadata非null返回ConsumerGroupMetadata对象，否则抛出异常</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleBulkRequest</span><span class="params">(BulkRequest request)</span>&#123;</span><br><span class="line">        <span class="comment">//有子请求</span></span><br><span class="line">        <span class="keyword">if</span>(Optional.ofNullable(request).map(o -&gt; o.requests()).map(o -&gt; o.size()).orElse(<span class="number">0</span>) &gt; <span class="number">0</span>)&#123;<span class="comment">//map方法返回的还是个Optional对象</span></span><br><span class="line">            <span class="comment">//第一个请求的索引不带有正式或者测试的前缀，认定为用户直接调用的Bulk方法</span></span><br><span class="line">            <span class="keyword">if</span>(IndexUtils.hasPreFix(request.requests().get(<span class="number">0</span>).index()) == <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="comment">//根据线程上下文的影子标识，修改索引名称</span></span><br><span class="line">                <span class="keyword">if</span>(Zpt.shouldAsShadowOp())&#123;</span><br><span class="line">                    bulkRequestHandler.addPrefix(request);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//否则，认识为 BulkProcessor 调用的此方法,由于BulkProcessor已经对索引加了前缀，要把Prod前缀去掉</span></span><br><span class="line">                bulkRequestHandler.delProdPreFix(request);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="lambda-list转换map时，把多个参数拼接作为key"><a href="#lambda-list转换map时，把多个参数拼接作为key" class="headerlink" title="lambda list转换map时，把多个参数拼接作为key"></a>lambda list转换map时，把多个参数拼接作为key</h3><p>Map&lt;String, Parts&gt; partsMap &#x3D; synList.stream().collect(Collectors.toMap(k -&gt; k.getOe()+k.getOeId()+k.getPartGroupId()+k.getStdPartId()+k.getBrandCode(), part -&gt; part));</p>

  </article>
</div>


    




</div>

<div class="footer-wrapper container">
  <footer class="footer clearfix">
    <div class="clearfix">
    <a href="https://zhangyj131.github.io" class="footer-logo">
      <i class="fa fa-github"></i>
    </a>
    <ul class="footer-social-link">
      <li>© 2019 zhangyj</li>
      <li><a href="https://zhangyj131.github.io">Home</a></li>
      
      <li><a target="_blank" rel="noopener" href="https://github.com/zhangyj131">Github</a></li>
      
    </ul>
    <div class="footer-theme-info">
      Theme <a target="_blank" rel="noopener" href="//github.com/sabrinaluo/hexo-theme-replica">Replica</a>
      by <a target="_blank" rel="noopener" href="//github.com/sabrinaluo">Hiitea</a> ❤ Powered by Hexo
    </div>
    </div>
    
  </footer>
</div>




<script src="/js/main.js"></script>

</body>
</html>
